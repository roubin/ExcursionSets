\documentclass[12pt]{article}

\input{inc/style_handbook}
\input{inc/shortcuts_es}

\begin{document}
\maintitle{Handbook on excursion sets}

\tableofcontents
\newpage
\section{Priliminary calculations}
\subsection{Differentiation under the integral sign}
\begin{equation}
  \frac{\text{d}}{\text{d}x}\left(\ \int_{a(x)}^{b(x)} f(x,t) dt \ \right) = f(x,b(x))b'(x)-f(x,a(x))a'(x)+\int_{a(x)}^{b(x)}\frac{\partial}{\partial x}f(x,t)dt
\end{equation}
\subsection{Functions}
\subsubsection{Gamma function: $\GamFunc$}
\begin{equation}\GamFunc: z \rightarrow \int_0^\infty t^{z-1}e^{-t} dt\end{equation}
\subsubsection{Error function: $\erf$}
\begin{equation}\erf(x)=\frac{2}{\sqrt\pi}\int_0^xe^{-t^2}dt\end{equation}
\subsection{Lipschitz-Killing curvatures (LKC)}
\subsubsection{For a regular shapes in 1,2 and 3 dimensions}
\begin{equation}
  \text{For a cube} \ \ \MRF_N=\prod_{i=1}^{N}[0\ \Msize], \ \ \LKC_j(\MRF_N)= \left( \begin{array}{c} N \\ j \end{array} \right) \Msize^j
\end{equation}
\begin{equation}
  \text{For a parallelepiped} \ \ \PRF_N=\prod_{i=1}^{N}[0\ \Msize_i], \ \ \LKC_j(\MRF_N)= \dots
\end{equation}
\begin{center}
  \begin{tabular}{c|c|c|l}
    $N$ & LKC & Value & Meaning \\
    \hline
    $1$ & $\LKC_0(\MRF)$ & $1$ & Euler Characteristic \\
    $1$ & $\LKC_1(\MRF)$ & $\Msize$ & Length of the segment \\
    \hline
    $2$ & $\LKC_0(\MRF)$ & $1$ & Euler Characteristic \\
    $2$ & $\LKC_1(\MRF)$ & $2\Msize$ & Half the boundary length \\
    $2$ & $\LKC_2(\MRF)$ & $\Msize^2$ & Surface area \\
    \hline
    $3$ & $\LKC_0(\MRF)$ & $1$ & Euler Characteristic \\
    $3$ & $\LKC_1(\MRF)$ & $3\Msize$ & Twice the caliper diameter \\
    $3$ & $\LKC_2(\MRF)$ & $3\Msize^2$ & Half the surface area \\
    $3$ & $\LKC_3(\MRF)$ & $\Msize^3$ & Volume \\
    \hline
    $3$ & $\LKC_0(\PRF)$ & $1$ & Euler Characteristic \\
    $3$ & $\LKC_1(\PRF)$ & $\Msize_1+\Msize_2+\Msize_3$ & Twice the caliper diameter \\
    $3$ & $\LKC_2(\PRF)$ & $\Msize_1\Msize_2+\Msize_1\Msize_3+\Msize_2\Msize_3$ & Half the surface area \\
    $3$ & $\LKC_3(\PRF)$ & $\Msize_1\Msize_2\Msize_3$ & Volume \\
  \end{tabular}
\end{center}

\subsection{Volume of the unit ball}
\begin{minipage}{0.5\linewidth}
\begin{equation}\UB_N=\frac{\pi^{N/2}}{\GamFunc(1+N/2)}\end{equation}
\end{minipage}
\begin{minipage}{0.5\linewidth}
\begin{equation}
  \left|
  \begin{array}{l}
    \UB_0=1 \\
    \UB_1=2 \\
    \UB_2=\pi \\
    \UB_3=4\pi/3 \\
    \dots
  \end{array}
  \right.
\end{equation}
\end{minipage}

\subsection{Probabilistic Hermite polynomials}
\begin{minipage}{0.5\linewidth}
\begin{equation}\Hermite_n=(-1)^n e^{x^2/2} \frac{\text{d}^n}{\text{d}x^n}e{-x^2/2}\end{equation}
\end{minipage}
\begin{minipage}{0.5\linewidth}
\begin{equation}
  \left|
  \begin{array}{l}
    \Hermite_0(x)=1 \\
    \Hermite_1(x)=x \\
    \Hermite_2(x)=x^2-1 \\
    \Hermite_3(x)=x^3-3 \\
    \dots
  \end{array}
  \right.
\end{equation}
\end{minipage}

\subsection{Flag coefficients}
\begin{minipage}{0.5\linewidth}
\begin{equation}
  \left[ \begin{array}{c} n \\ j \end{array} \right] = 
  \left( \begin{array}{c} n \\ j \end{array} \right)\frac{\UB_n}{\UB_{n-j}\UB_j}
\end{equation}
\end{minipage}
\begin{minipage}{0.5\linewidth}
\begin{equation}
  \begin{array}{c|c|c}
    n & j & \text{flag} \\
    \hline
    0 & 0 & 1\\
    1 & 0 & 1\\
    1 & 1 & 1\\
    2 & 0 & 1\\
    2 & 1 & \pi/2\\
    2 & 2 & 1\\
    3 & 0 & 1\\
    3 & 1 & 2\\
    3 & 2 & 2\\
    3 & 3 & 1
  \end{array}
\end{equation}
\end{minipage}

\subsection{Second spectral moment}
\begin{equation}
  \SpecMom=\Varia\left\{\frac{\partial\, \GRF(\x)}{\partial\, x_i}\right\}= \frac{\text{d}^2\cov(h)}{\text{d}h^2}
\end{equation}
\begin{equation}
  \begin{array}{c|c|c}
    \text{Covariance} & \text{Parameter} & \SpecMom \\
    \hline
    \text{Gaussian} & - & 2\std^2/\Lc^2\\
  \end{array}
\end{equation}

\section{Gaussian Minkowsky functionals}
\subsection{Preliminary}
\subsubsection{Gaussian measure: $\GaussMeas^k(\HS)$}
\begin{equation}
  \GaussMeas^k(\HS) = \Proba\{\vGRV\in\HS\}=\frac{1}{\std^k(2\pi)^{k/2}} \int_\HS e^{-\|\x-\mean\|^2/2\std^2} d\x
\end{equation}
\subsubsection{Tube Taylor expansion}
\begin{equation}
  \GaussMeas^k(\tube(\HS,\ray))=\sum_{j=0}^{\infty} \frac{\ray^j}{j!}\GMFk_j(\HS)
\end{equation}

\subsection{GMFs for Gaussian distribution}
\subsubsection{Application to one-dimensional tail hitting set: $k=1$ and $\HS=\uinf$}
Tail probability $\TP$:
\begin{equation}
  \GaussMeas^1(\uinf) = \Proba\{\GRV\ge\lset\}=\frac{1}{\std\sqrt{2\pi}} \int_\lset^\infty e^{-(x-\mean)^2/2\std^2} dx=\TP(\lset)
\end{equation}
Error function $\erf$:
\begin{subequations}
  \begin{align*}
    \GaussMeas^1(\uinf) = \TP(\lset) & = \frac{1}{\std\sqrt{2\pi}} \int_{\frac{\lset-\mean}{\std\sqrt{2}}}^\infty e^{-t^2} \sqrt{2}\std dt = \frac{1}{\sqrt{\pi}} \int_{\frac{\lset-\mean}{\std\sqrt{2}}}^\infty e^{-t^2} dt \\
                          & = \frac{1}{\sqrt{\pi}} \left[ \int_0^\infty e^{-t^2} dt - \int_0^{\frac{\lset-\mean}{\std\sqrt{2}}} e^{-t^2} dt \right]\\
                          & = \frac{1}{\sqrt{\pi}} \left[ \frac{\sqrt{\pi}}{2} - \frac{\sqrt{\pi}}{2}\erf\left(\frac{\lset-\mean}{\std \sqrt{2}}\right) \right]\\
                          & = \frac{1}{2}\left(1-\erf\left(\frac{\lset-\mean}{\std\sqrt{2}}\right)\right)
  \end{align*}
\end{subequations}
Tube expansion:
\begin{equation}
  \GaussMeas^1(\tube(\uinf,\ray))=\GaussMeas^1([\lset-\ray\ \infty))=\TP(\lset-\ray)=\sum_{j=0}^{\infty} \frac{(-\ray)^j}{j!} \frac{\text{d}^j \TP(\lset)}{\text{d} \lset^j}
\end{equation}
Identification:
\begin{itemize}
\item Notations:
  \begin{subequations}
    \begin{flalign}
      & \text{Tail hitting set:} \ \ \HST=\uinf & \\
      & \text{Variable substitution:} \ \ \clset \leftarrow \frac{\lset-\mean}{\std} &
    \end{flalign}
  \end{subequations}
\item For $j=0$:
\begin{equation}
  \GMFa_0(\HST)=\TP(\lset)
\end{equation}
\item For $j>0$:
\begin{equation}
  \GMFa_j(\HST)=(-1)^j\frac{\text{d}^j\TP(\lset)}{\text{d}\lset^j}=\frac{e^{-(\lset-\mean)^2/2\std^2}}{\std^j\sqrt{2\pi}}\Hermite_{j-1}((\lset-\mean)/\std)
\end{equation}
\item First values:
\begin{equation}
  \left|
  \begin{array}{l}
    \GMFa_0(\HST) = \frac{1}{2}\left(1-\erf\left(\frac{\clset}{\sqrt{2}}\right)\right) \\ \\
    \GMFa_1(\HST) = \frac{1}{\std  \sqrt{2\pi}}\ e^{-\clset^2/2} \\ \\
    \GMFa_2(\HST) = \frac{1}{\std^2\sqrt{2\pi}}\ \clset \ e^{-\clset^2/2} \\ \\
    \GMFa_3(\HST) = \frac{1}{\std^3\sqrt{2\pi}}\ \left(\clset^2-1\right) \ e^{-\clset^2/2} \\ \\
    \GMFa_4(\HST) = \frac{1}{\std^4\sqrt{2\pi}}\ \left(\clset^3-3\clset\right) \ e^{-\clset^2/2} \\ \\
    \dots
  \end{array}
  \right.
\end{equation}
%\begin{figure}[!h]
%  \scalebox{0.9}{\input{./figures/gmf_tail}}
%  \caption{First 4 GMF for $\std^2=2$ and $\HS=\HST=\uinf$}
%\end{figure}
\item Derivatives:
\begin{equation}
  \forall j, \ \ \frac{\text{d}\GMFa_j}{\text{d}\lset}(\HST)=(-1)^j\frac{\text{d}^{j+1}\TP(\lset)}{\text{d}\lset^{j+1}}=-\GMFa_{j+1}(\HST)
\end{equation}
\end{itemize}

\subsubsection{Application to one-dimensional cumulative hitting set: $k=1$ and $\HS=\minfu$}
Cumulative probability $\CDP$:
\begin{equation}
  \GaussMeas^1(\minfu) = \Proba\{\GRV\le\lset\}=\frac{1}{\std\sqrt{2\pi}} \int_{-\infty}^\lset e^{-(x-\mean)^2/2\std^2} dx=\CDP(\lset)
\end{equation}
Error function $\erf$:
\begin{equation}
  \GaussMeas^1(\minfu)=\CDP(\lset)=\frac{1}{2}\left(1+\erf\left(\frac{\lset-\mean}{\std\sqrt{2}}\right)\right)
\end{equation}
Tube expension:
\begin{equation}
  \GaussMeas^1(\tube(\minfu,\ray))=\GaussMeas^1((-\infty\ \lset+\ray])=\CDP(\lset+\ray)=\sum_{j=0}^{\infty} \frac{\ray^j}{j!} \frac{\text{d}^j \CDP(\lset)}{\text{d} \lset^j}
\end{equation}
Identification:
\begin{itemize}
\item Notations:
  \begin{subequations}
    \begin{flalign}
      & \text{Tail hitting set:} \ \ \HSC=\minfu & \\
      & \text{Variable substitution:} \ \ \clset \leftarrow \frac{\lset-\mean}{\std} &
    \end{flalign}
  \end{subequations}
\item For $j=0$:
\begin{equation}
  \GMFa_0(\HSC)=\CDP(\lset)
\end{equation}
\item For $j>0$:
\begin{equation}
  \GMFa_j(\HSC)=\frac{\text{d}^j\CDP(\lset)}{\text{d}\lset^j}=(-1)^{j+1}\frac{e^{-(\lset-\mean)^2/2\std^2}}{\std^j\sqrt{2\pi}}\Hermite_{j-1}((\lset-\mean)/\std)
\end{equation}
\item First values:
\begin{equation}
  \left|
  \begin{array}{l}
    \GMFa_0(\HSC) = \frac{1}{2}\left(1-\erf\left(\frac{\clset}{\sqrt{2}}\right)\right) \\ \\
    \GMFa_1(\HSC) = \frac{1}{\std  \sqrt{2\pi}}\ e^{-\clset^2/2} \\ \\
    \GMFa_2(\HSC) = \frac{-1}{\std^2\sqrt{2\pi}}\ \clset \ e^{-\clset^2/2} \\ \\
    \GMFa_3(\HSC) = \frac{1}{\std^3\sqrt{2\pi}}\ \left(\clset^2-1\right) \ e^{-\clset^2/2} \\ \\
    \GMFa_4(\HSC) = \frac{-1}{\std^4\sqrt{2\pi}}\ \left(\clset^3-3\clset\right) \ e^{-\clset^2/2} \\ \\
    \dots
  \end{array}
  \right.
\end{equation}
\begin{figure}[!h]
  \centering
  \hspace*{\fill}
  \subfigure[$\HS=\HSC=\uinf$]{\scalebox{0.5}{\input{./figures/gmf_tail}}}\hfill
  \subfigure[$\HS=\HSC=\minfu$]{\scalebox{0.5}{\input{./figures/gmf_cumulative}}}\hspace*{\fill}
  \caption{First 4 GMF for $\std^2=2$}
\end{figure}
\item Derivatives:
\begin{equation}
  \forall j, \ \ \frac{\text{d}\GMFa_j}{\text{d}\lset}(\HSC)=\frac{\text{d}^{j+1}\CDP(\lset)}{\text{d}\lset^{j+1}}=\GMFa_{j+1}(\HSC)
\end{equation}
\end{itemize}

\subsection{GMFs for Gaussian related Random Fields}
\begin{equation}
  \GRRF : \Univ\times\RN \overset{\vGRF}{\rightarrow} \Rk \overset{\rfunc}{\rightarrow} \RR
\end{equation}
\begin{equation}
    \Proba\left\{\GRRF\in\HS\right\} = \Proba\left\{\rfunc(\GRF)\in\HS\right\} = \Proba\left\{\GRF\in\irfunc(\HS)\right\} = \GaussMeas^k(\irfunc(\HS))
\end{equation}

\subsubsection{Log-normal distribution}
\begin{equation}
  k=1 \ \ \text{,} \ \ \rfunc=\exp \ \ \text{and} \ \ \irfunc=\ln
\end{equation}
\begin{equation}
  \left|
  \begin{array}{lcl}
    \mean & = &\ln(\meanln) - \frac{1}{2}\ln(1+\stdln^2/\meanln^2) \\
    \std^2 & = & \ln(1+\stdln^2/\meanln^2)
  \end{array}
  \right.
\end{equation}

\begin{itemize}
\item Notations:
  \begin{subequations}
    \begin{flalign}
      & \text{Log tail hitting set:} \ \ \lnHST=\lnuinf & \\
      & \text{Log cumulative hitting set:} \ \ \lnHSC = \minflnu & \\
      & \text{Variable substitution:} \ \ \lnclset \leftarrow \frac{\ln(\lset)-\mean}{\std} &
    \end{flalign}
  \end{subequations}
\item For $\HS=\HST=\uinf \ \ \rightarrow \ \ \irfunc(\HS) = \lnHST = \lnuinf$
\begin{equation}
  \left|
  \begin{array}{l}
    \GMFa_0(\lnHST) = \frac{1}{2}\left(1-\erf\left(\frac{\lnclset}{\sqrt{2}}\right)\right) \\ \\
    \GMFa_1(\lnHST) = \frac{1}{\std  \sqrt{2\pi}}\ e^{-\lnclset^2/2} \\ \\
    \GMFa_2(\lnHST) = \frac{1}{\std^2\sqrt{2\pi}}\ \lnclset \ e^{-\lnclset^2/2} \\ \\
    \GMFa_3(\lnHST) = \frac{1}{\std^3\sqrt{2\pi}}\ \left(\lnclset^2-1\right) \ e^{-\lnclset^2/2} \\ \\
    \GMFa_4(\lnHST) = \frac{1}{\std^4\sqrt{2\pi}}\ \left(\lnclset^3-3\lnclset\right) \ e^{-\lnclset^2/2} \\ \\
    \dots
  \end{array}
  \right.
\end{equation}
Derivatives:
\begin{equation}
  \left|
  \begin{array}{l}
    \text{Help:} \ \ \left(e^{-(\ln(x)-\mean)^2/2\std^2}\right)' = -\frac{1}{\std^2} \frac{\ln(x)-\mean}{x}\ e^{-(\ln(x)-\mean)^2/2\std^2} \\ \\
    \frac{\text{d} \GMFa_0(\lnHST)}{\text{d}\lset} = \frac{-1}{\std\sqrt{2\pi}} \frac{1}{\lset}\ e^{-(\ln(\lset)-\mean)^2/2\std^2} \\ \\
    \frac{\text{d} \GMFa_1(\lnHST)}{\text{d}\lset} = \frac{-1}{\std^2\sqrt{2\pi}} \frac{1}{\lset}\frac{\ln(\lset)-\mean}{\std}\ e^{-(\ln(\lset)-\mean)^2/2\std^2} \\ \\
    \frac{\text{d} \GMFa_2(\lnHST)}{\text{d}\lset} = \frac{-1}{\std^3\sqrt{2\pi}} \frac{1}{\lset}\left[ \frac{(\ln(\lset)-\mean)^2}{\std^2} - 1 \right]\ e^{-(\ln(\lset)-\mean)^2/2\std^2} \\ \\
    \frac{\text{d} \GMFa_3(\lnHST)}{\text{d}\lset} = \frac{-1}{\std^4\sqrt{2\pi}} \frac{1}{\lset}\left[ \frac{(\ln(\lset)-\mean)^3}{\std^3} - 3\frac{(\ln(\lset)-\mean)}{\std} \right]\ e^{-(\ln(\lset)-\mean)^2/2\std^2} \\ \\
    \dots \\ \\
    \text{Guess would be:} \ \ \forall j\ge0, \\
    \frac{\text{d} \GMFa_j(\lnHST)}{\text{d}\lset} = \frac{-1}{\std^{j+1}\sqrt{2\pi}}\frac{1}{\lset}\Hermite_{j}(\lnclset)\ e^{-\lnclset^2/2}
  \end{array}
  \right.
\end{equation}

\item For $\HS=\zu \ \ \rightarrow \ \ \irfunc(\HS) = \lnHSC = \minflnu$
\begin{equation}
  \left|
  \begin{array}{l}
    \GMFa_0(\lnHSC) = \frac{1}{2}\left(1+\erf\left(\frac{\lnclset}{\sqrt{2}}\right)\right) \\ \\
    \GMFa_1(\lnHSC) = \frac{1}{\std  \sqrt{2\pi}}\ e^{-\lnclset^2/2} \\ \\
    \GMFa_2(\lnHSC) = \frac{-1}{\std^2\sqrt{2\pi}}\ \lnclset \ e^{-\lnclset^2/2} \\ \\
    \GMFa_3(\lnHSC) = \frac{1}{\std^3\sqrt{2\pi}}\ \left(\lnclset^2-1\right) \ e^{-\lnclset^2/2} \\ \\
    \GMFa_4(\lnHSC) = \frac{-1}{\std^4\sqrt{2\pi}}\ \left(\lnclset^3-3\lnclset\right) \ e^{-\lnclset^2/2} \\ \\
    \dots
  \end{array}
  \right.
\end{equation}
Derivatives:
\begin{equation}
  \left|
  \begin{array}{l}
    \text{Guess would be:} \ \ \forall j\ge0, \\
    \frac{\text{d} \GMFa_j(\lnHSC)}{\text{d}\lset} = \frac{(-1)^{j}}{\std^{j+1}\sqrt{2\pi}}\frac{1}{\lset}\Hermite_{j}(\lnclset)\ e^{-\lnclset^2/2}
  \end{array}
  \right.
\end{equation}

\end{itemize}

\newpage
\section{Expectation Formula}
\subsection{Gaussian distribution}
\subsubsection{General case}
\begin{equation}
  \Expec\left\{\ \LKC_j(\ES) \ \right\} = \sum_{i=0}^{N-j} \left[ \begin{array}{c}i+j\\i\end{array}\right]\left(\frac{\SpecMom}{2\pi}\right)^{i/2}\LKC_{i+j}(\MRF)\GMFk_i(\irfunc(\HS))
\end{equation}
Notations:
  \begin{subequations}
    \begin{flalign}
      & \text{LKC of $\MRF$:} \ \ \LKC_j(\MRF) = \LKC_j^\MRF & \\
      & \text{LKC of $\ES$:} \ \ \LKC_j(\ES) = \LKC_j^\ES & \\
      & \text{GMF of $\irfunc(\HS)$:} \ \  \GMFk_j(\irfunc(\HS)) = \GMFk_j
    \end{flalign}
  \end{subequations}
\subsubsection{One dimension}
\begin{subequations}
\begin{align}
  &\Expec\left\{\LKC_0^\ES\right\} = \left(\frac{\SpecMom}{2\pi}\right)^{1/2}\LKC_1^\MRF\GMFk_1 + \LKC_0^\MRF\GMFk_0\\
  &\Expec\left\{\LKC_1^\ES\right\} = \LKC_1^\MRF\GMFk_0
\end{align}
\end{subequations}


\begin{figure}[!h]
  \centering
  \hspace*{\fill}
  \subfigure[Euler Characteristic]{\scalebox{0.5}{\input{./figures/elkc_1D_LKC0}}}\hfill
  \subfigure[Length]{\scalebox{0.5}{\input{./figures/elkc_1D_LKC1}}}\hspace*{\fill}
  \caption{Expectation of LKC for $\Msize=100$, $\std^2=2$ and $\HS=\uinf$ in 1D.}
\end{figure}

\begin{figure}[!h]
  \centering
  \hspace*{\fill}
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_exp_1D_lognormal_0}}}\hfill
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_exp_1D_lognormal_1}}}\hspace*{\fill}
  \caption{Expectation of LKC for $\Msize=100$, $\mean=0.5$, $\std^2=2$, $\Lc=0.5$, and $\HS=\zu$ (log-normal distribution with cumulative hitting set) in 1D. Experimental results are calculated over $1\,000$ realizations.}
\end{figure}

\newpage 
\subsubsection{Two dimensions}
\begin{subequations}
\begin{align}
  &\Expec\left\{\LKC_0^\ES\right\} = \frac{\SpecMom}{2\pi}\LKC_2^\MRF\GMFk_2 + \sqrt{\frac{\SpecMom}{2\pi}}\LKC_1^\MRF\GMFk_1 + \LKC_0^\MRF\GMFk_0\\
  &\Expec\left\{\LKC_1^\ES\right\} = \sqrt{\frac{\SpecMom\pi}{8}}\LKC_2^\MRF\GMFk_1 + \LKC_1^\MRF\GMFk_0\\
  &\Expec\left\{\LKC_2^\ES\right\} = \LKC_2^\MRF\GMFk_0
\end{align}
\end{subequations}


\begin{figure}[!h]
  \centering
  \hspace*{\fill}
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_exp_2D_gaussian_0}}}\hfill
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_exp_2D_gaussian_1}}}\hfill
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_exp_2D_gaussian_2}}}\hspace*{\fill}
  \caption{Expectation of LKC for $\Msize=100$, $\mean=0.0$, $\std^2=2$, $\Lc=5$, and $\HS=\uinf$ (gaussian distribution with tail hitting set) in 2D. Experimental results are calculated over $1\,000$ realizations.}
\end{figure}

\begin{figure}[!h]
  \centering
  \hspace*{\fill}
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_exp_2D_lognormal_0}}}\hfill
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_exp_2D_lognormal_1}}}\hfill
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_exp_2D_lognormal_2}}}\hspace*{\fill}
  \caption{Expectation of LKC for $\Msize=100$, $\mean=0.0$, $\std^2=2$, $\Lc=5$, and $\HS=\zu$ (lognormal distribution with cumulative hitting set) in 2D. Experimental results are calculated over $1\,000$ realizations.}
\end{figure}

\newpage
\subsubsection{Three dimensions}
\begin{subequations}
\begin{align}
  &\Expec\left\{\LKC_0^\ES\right\} = \\%\frac{\SpecMom}{2\pi}\LKC_2^\MRF\GMFk_2 + \sqrt{\frac{\SpecMom}{2\pi}}\LKC_1^\MRF\GMFk_1 + \LKC_0^\MRF\GMFk_0\\
  &\Expec\left\{\LKC_1^\ES\right\} = \\%\sqrt{\frac{\SpecMom\pi}{8}}\LKC_2^\MRF\GMFk_1 + \LKC_1^\MRF\GMFk_0\\
  &\Expec\left\{\LKC_2^\ES\right\} = \\%\LKC_2^\MRF\GMFk_0
  &\Expec\left\{\LKC_3^\ES\right\} = \LKC_3^\MRF\GMFk_0
\end{align}
\end{subequations}

\begin{figure}[!h]
  \centering
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_exp_3D_gaussian_0}}}\hspace{1.2cm}
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_exp_3D_gaussian_1}}}\\
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_exp_3D_gaussian_2}}}\hspace{1.2cm}
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_exp_3D_gaussian_3}}}\\
  \caption{Expectation of LKC for $\PRF=100\times 20 \times 20$, $\mean=0.0$, $\std^2=2$, $\Lc=2$, and $\HS=\uinf$ (gaussian distribution with tail hitting set) in 3D. Experimental results are calculated over $100$ realizations.}
\end{figure}

\newpage
\section{Size effect}
In this section another approach using expected values of excursion set characteristics is proposed. Up to this point, this mathematical tool has been used in order to yield actual morphologies and predict their geometrical and topological characteristics. The continuum aspect of correlated RFs was concealed by the thresholding method used (level set) which led to discrete fields (excursion sets). Herein, RFs directly represent a material property (ultimate stress field) and the excursion set theory is used in order to catch statistical information on its extrema.
\par A theoretical method for size effect modeling of brittle heterogeneous materials is proposed. In this field, the main result comes from the early studies of \cite{weibull_statistical_1951} based on the theory of the weakest link. The authors proposed an analytical solution for the global failure criterion, considering a discrete structure of independent brittle links with a specific distribution probability of local failure criterion. With no spatial correlation between each link, this theory leads inevitably to large scale size effect. The two current theories of Zden\v{e}k P. Ba\v{z}ant and Alberto Carpinteri, trying to describe the size effect for the missing scales, are the main results of the extensive literature existing on this topic. The former tends, in many ways, to describe the size effect using both non-local model and stochastic approach \cite{sab_unified_1993}, or more recently using the so-called energetic-statistical size effect mixing strength redistribution theory in a fracture process zone and Weibull's theory \cite{bazant_probability_2004}. The latter considers material heterogeneities with a fractal model in order to represent size effects for quasi-brittle materials \cite{carpinteri_mechanics_2003}. On the other hand, numerical simulations have been made using stochastic integrations and correlated RFs in order to describe material properties \cite{colliat_stochastic_2007}. These methods are quickly time consuming and the underlying numerical implementation brings an inevitable limitation regarding the observation scale.
\par The idea behind this method is to extend the Weibull theory to lower scales by adding the spatial structure of \emph{correlated} RFs. A continuum representation of the spatial variability through scales can theoretically be made by defining a ratio $\rl=\Lc/\Msize$ between the spatial parameter of the correlated RF covariance function $\Lc$ and the size of its definition domaine $\Msize$. As already stated just above, heterogeneities modeling is directly made through a variation of material properties (and not by through definition of different phases). The continuum aspect of correlated RFs statistically represents a local ultimate failure stress $\slim(\x,\w)$ on a structure $\MRF$. RFs are here used in a direct way, even if the discrete aspect of excursion set and their expected Euler characteristic are used in order to define the global failure stress $\sfail$ of the structure. The whole framework has to be seen on a purely theoretical and analytical point of view. Contrary to stochastic integration methods, the knowledge of expected information on RFs avoids generating actual RF realizations. Hence, there is no scale limitation.

\subsection{Correlation lengths as scale parameters}
As it has been pointed out during this chapter, the correlation length $\Lc$ can been seen as a size parameter of a correlated RF. Herein, a constant value of $\Lc$ is chosen, fixing the average size of the heterogeneities considered. The dimension of the domain $\MRF$ (where the RF is defined) represents the size of the whole structure. If $\Msize$ is the characteristic length of $\MRF$ (for example: the length of a segment in the one-dimensional space, the length of the side of a square in a two-dimensional space\dots), its value determines the observation scale. In order to let the heterogeneity size unspecified, the ratio $\rl=\Lc/\Msize$ is taken into consideration. Nonetheless, $\Lc$ still as to be seen as a constant and $\Msize$ a variable. Realizations of RFs for different ratios $\rl$ are shown in Fig. \ref{fig:size-efect:rf2d} on a two-dimensional square.
\begin{description}
  \item \emph{For $\rl \gg 1$} \\ The structure is very small compared to the heterogeneity size. The RF tends to be a constant field and is equivalent to a single RV with no spatial information. It represents the material scale, the validity domain of continuum damage mechanics (CDM) where the failure stress does not depend on the size of the structure (see Fig. \ref{fig:size-efect:rf2d:1}).
  \item \emph{For $\rl \ll 1$} \\ The structure is very large compared to the heterogeneity size. The RF tends to be equivalent to a white noise (completely uncorrelated), leading to a loss of spatial structures. It represents the scale of big structures as the Weibull theory does, retrieving the linear fracture mechanic (LFM) domain of expertise (see Fig. \ref{fig:size-efect:rf2d:3}).
  \item \emph{For $\rl \approx 1$} \\ The RF represents the missing scale range where the continuum statistical information of correlated RFs for various $\rl$ can link together material and big structure scales. Hence, it can model size effect for civil engineering structures (see Fig. \ref{fig:size-efect:rf2d:2}).
\end{description}
\begin{figure}[h!]
  \centering\hspace*{\fill}
  \subfigure[$\rl \gg 1$.\label{fig:size-efect:rf2d:1}]{\epsfig{figure=./figures/fromPhD/Lc_big.eps,width=0.3\linewidth}}\hfill
  \subfigure[$\rl \approx 1$.\label{fig:size-efect:rf2d:2}]{\epsfig{figure=./figures/fromPhD/Lc_small.eps,width=0.3\linewidth}}\hfill
  \subfigure[$\rl \ll 1$.\label{fig:size-efect:rf2d:3}]{\epsfig{figure=./figures/fromPhD/Lc_white_noise.eps,width=0.3\linewidth}}\hspace*{\fill}
  \caption{Realization of two-dimensional correlated RFs for various $\rl$ ratios.\label{fig:size-efect:rf2d}}
\end{figure}

\subsection{One dimensional case}
In this study, a one-dimensional bar in tension is considered. The source of uncertainty is modeled by a statistical representation of the local failure criterion $\slim(x,\w)$. Due to the positiveness of stress fields in tension, the \emph{log-normal} distribution is used. Since log-normal distribution is Gaussian related, the results of the previous section are applicable by a simple transformation of the hitting set $S=\exp$. The spatial structure representation is done by using correlated RF with Gaussian covariance function of correlation length $\Lc$. The continuum domain represented is a one-dimensional bar $\MRF$ of length $\Msize$. For this specific case, the global brittle failure of a bar $\MRF$ is assumed to occur when, at least, the minimum value of $\slim(x,\w)$ is reached by the stress field. If $\sfail(\w)$ is this criterion, it can be defined for a realization $i$ by: 
\begin{equation}
  \sfail(\w_i) = \underset{x \in \MRF_i}{\inf}\left(\slim(x,\w_i)\right).
  \label{eq:size-effect:failure-criterion}
\end{equation}
It occurs that this equation can directly be linked with the Euler characteristic $\EC$ of an excursion sets. Let $\ES(\s) = \left\{x \in \MRF \ | \ 0 \le \sigma_{y}(x,\omega)\leq\s \ \right\}$ be an excursion set where the constant stress state of the bar can been seen as a level set. With this definition, the excursion set represents the part of the bar (subset of $\MRF$) where the stress is above the local failure criterion $\slim(x,\w)$. The global failure criterion of Eq. \ref{eq:size-effect:failure-criterion} can therefore be seen in terms of excursion set; $\sfail$ being the stress state when, with increasing $\s$, $\ES(\s)$ changes from being a void subset of $\MRF$ ($\EC = 0$) to a single connected component ($\EC = 1$).
\par A result of \cite{adler_new_2008} on statistical thresholding technics links the probability of reaching these minima and the expected Euler characteristic as follows:
\begin{equation}
  \label{eq:size-effect:prob-failure-criterion}
  \Proba\left\{ \underset{x\in \MRF}{\inf}\left( \slim(x,\w) \right) \leq \s \right\} \approx \Expec\left\{ \EC\left(\ES(\s)\right) \right\} \ \ \text{``for low $\sigma$''}.
\end{equation}
The major improvement that Eq. \ref{eq:size-effect:prob-failure-criterion} provides is the knowledge of statistical information on $\sfail(\w)$, and with it, the need of Monte Carlo simulations with actual realizations $i$ as suggested by Eq. \ref{eq:size-effect:failure-criterion}. Then, the initial failure criterion of the structure can be reformulated in terms of probability $q$. This leads to:
\begin{equation}
	\label{eq:size-effect:global-stress}
	\sfail(q) = \left\{ \s \ | \ \Proba\left\{ \underset{x\in \MRF}{\inf}\left( \slim(x,\w) \right) \leq \s \right\} = q \right\}.
\end{equation}
The expected value of the Euler characteristic being analytically known, Eq. \ref{eq:size-effect:prob-failure-criterion} and Eq. \ref{eq:size-effect:global-stress} allow the ultimate stress criterion of the bar to be analytically determined, for a given failure probability $q$.
\par In order to scan every observation scales possible, Eq. \ref{eq:size-effect:global-stress} is solved for a large scale range $10^{-9}\le\rl\le10^3$. Since $\Lc$ is fixed by the heterogeneity size, the different scales are therefore represented by defining a single $\slim(x,\w)$ (with the same covariance function) for various $\Msize$ as represented in Fig. \ref{fig:size-effect:1D-various-sizes}. The mean and the variance of the log-normal correlated RF have physical meaning and can be determined depending on the material characteristics. While the mean value of $\slim(x,\omega)$ determines the value of the structural failure stress of small scales ($\rl\gg1$), its variance indicates the decreasing rate of the size effect for large scales ($\rl\ll1$).
\begin{figure}[h!]
  \centering
  \scalebox{0.55}{\LARGE\input{./figures/fromPhD/size_effect_1D_T}}
  \caption{Illustration of the local failure stress repartition on structures of various sizes.\label{fig:size-effect:1D-various-sizes}}
\end{figure}
\par In order to validate the theoretical framework, results of the same problem solved using a Monte-Carlo stochastic integration method are also given. On the one hand, the stochastic integration provides a full empirical distribution of $\sfail(\w)$ (defined by Eq. \ref{eq:size-effect:failure-criterion}) for several ratios $\rl$. On the other hand, the analytical results of $\sfail(q)$ depends directly on the probability parameter $q$ that, by definition of the ultimate stress Eq. \ref{eq:size-effect:global-stress}, is directly linked with quantiles of the previous empirical distribution. For example, $q=1/2$ corresponds to the $2$-quantile, \ie the median.
\par Fig. \ref{graph:size-effect:results:p} shows the resulting global failure stresses $\sfail$ for ratio $\rlinv=\rl^{-1}$ from $10^{-3}$ to $10^2$ with the Monte-Carlo method (in order to show results in the most commonly used manner, scales are represented by the inverse ratio $\rlinv=\rl^{-1}=\Msize/\Lc$). The inspection of larger scales is rapidly limited by the inconvenient resource consuming aspect of stochastic integrations. On the strength of its analytical base, the excursion set theory every scale can be inspected, here for $\rlinv$ varying from $10^{-3}$ to $10^{9}$. The Monte-Carlo integration results of global the failure stress distribution is given for the $2$, $10$, and $100$-quantile, corresponding to $q=1/2$, $1/10$, and $1/100$, respectively. In both method, the mean and the variance of the \emph{log-normal} distribution are both taken to be $10$. The \textsc{RandomFields} package \cite{schlather_randomfields:_2012} of the \textsc{R} environment \cite{team_r:_2012} has been used in order to do the stochastic integration, using $10\,000$ integration points for each length. 
\begin{figure}[h!]
  \centering\hspace*{\fill}
  \subfigure[Comparison between theoretical results and Monte-Carlo simulations for various quantiles.\label{graph:size-effect:results:p}]{\scalebox{0.55}{\input{./figures/fromPhD/log_1D_MonteCarlo_p}}}\hfill
  \subfigure[Impact of the variance on the size effect.\label{graph:size-effect:results:v}]{\scalebox{0.55}{\input{./figures/fromPhD/log_1D_var_v}}}\hspace*{\fill}
  \caption{Representation of the size effect through a failure stress criterion estimated for various scales.\label{graph:size-effect:results}}
\end{figure}
\par As expected, no size effect is observed at the small scale, $\rlinv < 10^{-2}$. For $q=1/2$, the value of the failure stress corresponds to the \emph{log-normal} distribution median (that is, due to the skewness of the distribution, a little less than the mean). As $\rlinv$ grows, the decrease of $\sfail$ representing the size effect can be seen. As for the impact of $q$, results show the good behavior. Indeed, for a safety probability of $90\%$ (meaning a failure probability of $q=0.1$), the failure stress is higher than for a safety of $99\%$ ($q=0.01$). The three curves drawn in Fig. \ref{graph:size-effect:results:v} represent the impact of the variance on size effect for a failure probability $q=1/2$. While $\Lc$ is the parameter of the correlated RF that represents the geometry of the heterogeneities, the variance can be seen as a description of the mechanical property discrepancy. Results show the natural principle that higher variations are, lower the values and larger the drop of $\sfail$ are.
\begin{figure}[!h]
  \centering
    \hspace*{\fill}
  \subfigure[Variation of the quantile]{\scalebox{0.5}{\input{./figures/size_effect_failure_stress_m10_v10}}}\hfill
  \subfigure[Variation of the variance]{\scalebox{0.5}{\input{./figures/size_effect_failure_stress_m10_q001}}} \hfill
  \subfigure[Variation of the mean]{\scalebox{0.5}{\input{./figures/size_effect_failure_stress_v10_q001}}}\hspace*{\fill}
  \caption{Size Effect: variations around $\meanln=10$, $\stdln^2=10$ and $q=1\%$ in 1D.}
\end{figure}

\subsection{Two dimensional case}
\begin{figure}[!h]
  \centering
  \hspace*{\fill}
  \subfigure[$\Msize=0.001$\label{fig:2D:EC:small_size}]{\scalebox{0.5}{\input{./figures/size_effect_2D_different_Euler_behaviors_l0.001}}}\hfill
%  \subfigure[$\Msize=0.8$]  {\scalebox{0.5}{\input{./figures/size_effect_2D_different_Euler_behaviors_l0.8}}}\\
  \subfigure[$\Msize=2.5$\label{fig:2D:EC:medium_size}]  {\scalebox{0.5}{\input{./figures/size_effect_2D_different_Euler_behaviors_l2.5}}}\hfill
  \subfigure[$\Msize=8$\label{fig:2D:EC:large_size}]    {\scalebox{0.5}{\input{./figures/size_effect_2D_different_Euler_behaviors_l8}}}  \hspace*{\fill}
  \caption{Euler characteristic for different specimen sizes $\Msize$ for $\meanln=0.5$, $\stdln^2=2$, $\Lc=1$, and $\HS=\zu$ (lognormal distribution with cumulative hitting set) in a 2D.\label{fig:2D:EC}}
\end{figure}

\begin{itemize}
  \item [\ref{fig:2D:EC:small_size}] Small sizes \\ \textbf{Direct percolation}. The first (and only) $\lset(\EC==q)$ correspond to the probability $q$ of percolation. There is only one disconnected element in the excursion set.
  \item [\ref{fig:2D:EC:medium_size}] Medium sizes \\ 
  \item [\ref{fig:2D:EC:large_size}] Large sizes \\ 
\end{itemize}


\subsection{Three dimensional case}
\begin{figure}[!h]
  \centering
    \hspace*{\fill}
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_th_3D_lognormal_0_constant_ratio}}}\hfill
  \subfigure{\scalebox{0.5}{\input{./figures/elkc_th_3D_lognormal_0_constant_area}}}\hspace*{\fill}
  \caption{.}
\end{figure}

                                                                                             
\bibliographystyle{ieeetr} % number, appearance order                                       
%\bibliographystyle{abbrv} % number, alphabetical order                                      
%\bibliographystyle{apalike} % full name, alphabetical order                     
%\bibliographystyle{alpha} % 3 letter name, alphabetical order                               
\bibliography{inc/biblio}                                                                          

\end{document}
